# code_change_task_20260121_174231

## 1. 任务概述
- 目标：保留现有托管数组对比版本，新增 NativeBuffer 版本，并将统计口径由中位数改为平均数，同时提高默认负载降低波动。
- 动机：减少 GC 干扰的同时保留原对比路径，提升测试稳定性与可重复性。
- 影响范围：UE::Tasks 性能对比入口、MainMenu 调用参数、测试方案文档与索引。

## 2. 聊天与讨论背景
- 用户要求新增 NativeBuffer 版本，保留当前版本。
- 要求统计口径改为平均数，并提升负载/迭代以降低误差。

## 3. 设计思路
- 新增 `RunNativeBufferAddOneAndSumCompare`，与托管数组版保持流程一致。
- 将统计从 Median 改为 Average。
- 调整默认参数与 MainMenu 调用参数以增加执行时长。
- 文档补充 NativeBuffer 入口与“平均值”说明。

## 4. 关键改动说明
- 托管数组版：默认参数增大、输出改为平均值。
- NativeBuffer 版：新增完整对比流程（UE::Tasks / Parallel.For / Task.Run）。
- MainMenu：提高默认测试负载。
- 文档：新增 NativeBuffer 入口说明、平均值口径与新默认参数。

## 5. 关键代码解析
- `RunNativeBufferAddOneAndSumCompare` 使用 `NativeBuffer<int>` 持有数据，通过指针访问减少 GC 压力。
- 平均值统计由 `Average` 统一计算三条路径耗时。

## 6. 涉及文件清单
- `Plugins/UnrealCSharp/Script/UE/Library/UETasksManagedVsCSharpPerfRunner.cs`
  - 新增 NativeBuffer 版本与平均值统计，提升默认负载。
- `Script/Game/Game/StackOBot/UI/MainMenu/MainMenu_C.cs`
  - 调整默认测试参数以增加执行时长。
- `docs/tech/unrealcsharp/ue-tasks-managed-test-plan.md`
  - 文档同步新增 NativeBuffer 入口与平均值口径说明。
- `docs/tech/index.md`
  - 更新索引“最后修改日志”。

## 7. 验证方式与结果
- 未执行（需用户运行 `UETasksManagedVsCSharpPerfRunner.RunManagedAddOneAndSumCompare` / `RunNativeBufferAddOneAndSumCompare` 验证）。
