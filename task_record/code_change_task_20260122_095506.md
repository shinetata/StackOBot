# 代码改动任务记录：进一步极简——UE::Tasks worker 线程仅执行一次 C# Action 并打日志（Runtime_Invoke）

- 时间：2026-01-22 09:55:06
- 目标：按用户要求，把“极简示例接口”再简化：不切片、不处理数据，只在 UE::Tasks worker 线程执行一次 C# `Action`，并通过 C++/C# 两侧日志证明运行在 worker 线程。
- 范围边界：只改示例接口；不影响现有 `ExecuteBatch` / `ExecuteBatchWithHandler`（thunk 版本）能力与测试链路。

## 1. 改动点概述

- C++：`ExecuteBatchWithDelegateInvoke` 改为真正的“极简示例”
  - internal call 参数改为：`(MonoObject* Delegate, bool wait)`
  - worker 中直接 `Runtime_Invoke(method, nullptr, nullptr, &exc)`（无参数）
  - 在调度点与 worker 点各打一次 `UE_LOG(LogUnrealCSharp, Log, ...)` 输出 `GT` 与 `tid`
- C#：同步修改 internal call 声明与 demo 调用
  - `extern` 变为：`FTasksSlice_ExecuteBatchWithDelegateInvokeImplementation(Action handler, bool wait)`
  - 新增/更新 demo：`UETasksSliceDelegateInvokeDemo.RunLogOnWorkerByRuntimeInvoke()`，内部调用 `Console.WriteLine` 输出 `ManagedThreadId`

## 2. 涉及文件清单

- `Plugins/UnrealCSharp/Source/UnrealCSharp/Private/Domain/InternalCall/FTasksSlice.cpp`
- `Plugins/UnrealCSharp/Script/UE/Library/FTasksSliceImplementation.cs`
- `Plugins/UnrealCSharp/Script/UE/Library/UETasksSliceDelegateInvokeDemo.cs`
- `task_record/code_change_task_20260122_095506.md`

## 3. 验证方式（建议）

1) 在任意 C# 入口调用：
   - `UETasksSliceDelegateInvokeDemo.RunLogOnWorkerByRuntimeInvoke()`
2) 查看 UE Output Log：
   - 过滤 `UETasksSliceDelegateInvoke`
   - 预期能看到：
     - C++ 侧 schedule 日志（通常 `GT=1`）
     - C++ 侧 worker invoke 日志（预期 `GT=0` 且 `tid` 与主线程不同）
     - C# `Console.WriteLine` 输出（`managedTid` 一般与主线程不同）

> 注：该示例走 `Runtime_Invoke`，仅用于演示链路，不用于性能对比；性能路径仍建议使用 thunk（`ExecuteBatchWithHandler`）。

