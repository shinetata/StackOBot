# code_change_task_20260121_170542

## 1. 任务概述
- 目标：进一步简化 UE::Tasks 托管测试链路，仅保留一个测试接口，并同步简化测试方案文档。
- 动机：用户希望 UE::Tasks 与 C# 原生并行对比流程更直观、尽量一致、减少不必要复杂度。
- 影响范围：UE::Tasks internal call、C# 封装与性能对比入口、测试方案文档与索引。

## 2. 聊天与讨论背景
- 用户要求“不要那么复杂”，仅做 UE::Tasks 执行 C# 与 C# 原生并行能力的性能对比。
- 强调保持一致与简单。

## 3. 设计思路
- 移除 UE::Tasks 侧分组与 chunk 参数，保持“逻辑任务 = UE::Tasks 任务”1:1 对齐。
- C# `ExecuteTask` 恢复为单索引签名，逻辑切片仍在 C# 测试入口中完成。
- 文档同步改为单层任务切分说明，并更新示例与流程图。

## 4. 关键改动说明
- C++：`ExecuteBatch` 仅接收 (state, taskCount, wait)，每个逻辑任务直接对应一个 UE::Tasks 任务。
- C#：`ExecuteBatch` 去掉 chunk 参数，`ExecuteTask` 改回单索引处理。
- 对比入口：`RunManagedAddOneAndSumCompare` 移除 UE::Tasks 分块参数，保持任务切片一致。
- 文档：移除二次切分与 chunk 说明，改为 1:1 模型。

## 5. 关键代码解析
- UE::Tasks：循环 `taskCount` 次创建任务，每个任务通过 thunk 调用 `ExecuteTask(stateHandle, index)`。
- C#：`ExecuteTask` 直接调用 `Action<int>`，由外层根据 index 计算数组切片并执行工作。

## 6. 涉及文件清单
- `Plugins/UnrealCSharp/Source/UnrealCSharp/Private/Domain/InternalCall/FTasks.cpp`
  - 移除 chunk 分组逻辑，简化为 1:1 任务调度。
- `Plugins/UnrealCSharp/Script/UE/Library/FTasksImplementation.cs`
  - internal call 签名去掉 chunk 参数。
- `Plugins/UnrealCSharp/Script/UE/Library/UETasksBatch.cs`
  - `ExecuteBatch` 简化、`ExecuteTask` 恢复单索引签名。
- `Plugins/UnrealCSharp/Script/UE/Library/UETasksManagedVsCSharpPerfRunner.cs`
  - 对比入口移除 UE::Tasks chunk 参数与轮转顺序。
- `docs/tech/unrealcsharp/ue-tasks-managed-test-plan.md`
  - 文档更新为单层任务切分与最新示例。
- `docs/tech/index.md`
  - 索引更新最新修改日志。

## 7. 验证方式与结果
- 未执行（需用户运行 `UETasksManagedVsCSharpPerfRunner.RunManagedAddOneAndSumCompare` 验证）。
