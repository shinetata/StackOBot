# code_change_task_20260120_172906 - 补充“UE worker 直接跑托管逻辑”在 PIE 下的风险、根因与工程结论

## 1. 任务概述
- **目标**：把近期围绕“TaskGraph/UE::Tasks worker 线程执行 C# 托管逻辑”导致 PIE 卡死/断言的讨论，整理回 `docs/tech/pgd/pgd-taskgraph-native-kernel-solution.md` 的合适位置，讲清楚问题、根因链路与工程结论，避免后续决策误读。
- **影响范围/边界**：仅补充文档内容；不改动任何运行时代码与测试代码。

## 2. 聊天与讨论背景（要点）
- 团队尝试让 TaskGraph worker 通过 `mono_thread_attach` + `Runtime_Invoke` 执行托管方法，以对标 Unity JobSystem 的“开发者写 C# 任务逻辑，系统并行调度”体验。
- 在 Editor/PIE 反复 Play/Stop 的生命周期下，出现卡死/闪退等稳定性问题；并且在开启 `--debugger-agent` 时，线程 attach/detach 的策略会触发 Mono 断言。
- 团队希望在文档中把这些事实、原因与结论说清楚，为后续“Native Kernel vs 托管执行”路线选择提供依据。

## 3. 设计思路
- 把“方式 A：worker 进入 Mono”这一节扩写为三段：**现象与证据**、**根因链路**、**工程结论**。
- 只写“仓库现有实现 + 调试中真实观测”能够支持的内容，避免对 Mono/UE 内部机制做无法验证的承诺。

## 4. 关键改动说明
- 在 `docs/tech/pgd/pgd-taskgraph-native-kernel-solution.md` 的 `1.1` 小节新增：
  - `1.1.1`：列出两类典型失败模式（cooperative GC 状态断言、debugger-agent TLS 断言）。
  - `1.1.2`：解释为什么“像 GT 一样清理 worker 的 Mono 状态”在工程上不成立（线程池复用 + 不可控阻塞点 + Mono 线程协作/调试器约束）。
  - `1.1.3`：给出与 PGD 决策相关的工程结论（PoC 可行但不适合作为高频主线；要对标 Unity 体验通常需要剥离 UE worker 或走 AOT/原生化）。

## 5. 涉及文件清单
- `docs/tech/pgd/pgd-taskgraph-native-kernel-solution.md`
  - 新增“PIE 卡死/断言风险”解释段落与结论。

## 6. 验证方式与结果
- **验证方式**：目视检查 Markdown 结构与段落插入位置；确认术语与路径引用均为仓库已有内容；无代码改动。
- **结果**：完成。

