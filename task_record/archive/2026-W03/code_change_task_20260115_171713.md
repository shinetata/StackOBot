# 代码变更任务记录：补充“线程状态不收敛/stop-the-world”ASCII 解释图

- 时间戳：2026-01-15 17:17:13
- 目标：把“为什么 attach 跨 PIE 留存可能导致二次 `LoadFromStream(Game.dll)` 卡死”的关键链路，用 ASCII 流程图讲清楚，并给出本仓库可引用的 Mono stop-the-world 证据来源。
- 范围：仅更新 `docs/tech` 文档与 `task_record` 索引，不修改任何代码实现。

## 聊天与讨论背景

- 用户追问两个点：
  1) “线程状态不收敛”是什么意思？
  2) “需要全局同步/锁（例如 stop-the-world）”有没有明确证据？
- 约束：文档需易懂，不默认读者了解关键术语；流程图优先 ASCII。

## 设计思路

- 把“卡死的外部观测”（GT 卡在 `Runtime_Invoke(LoadFromStream(Game.dll))`）与“运行时同步点”的概念连接起来；
- 引用本仓库第三方 Mono 头文件中的注释作为 stop-the-world/锁的本地证据来源；
- 用 ASCII 图描述：第一次 PIE attach → Stop 卸载 → 第二次 PIE 进入同步点并等待已 attach 线程收敛 → 外部表现为卡死。

## 关键改动说明

- 在文档中新增一节：
  - 解释“线程状态不收敛”的具体含义（安全点/可挂起/关键区）；
  - 给出 Mono stop-the-world 的本地证据路径：
    - `Plugins/UnrealCSharp/Source/ThirdParty/Mono/src/mono/metadata/details/profiler-types.h`
  - 给出 ASCII 流程图，帮助非引擎/非 Mono 背景读者理解“为什么卡在 `Runtime_Invoke` 里看起来像‘啥都没发生’”。

## 涉及文件清单

- 修改：`docs/tech/unrealcsharp-taskgraph-worker-mono-attach-pie-freeze.md`
  - 新增“线程状态不收敛”解释与 ASCII 图。
- 新增：`task_record/archive/2026-W03/code_change_task_20260115_171713.md`
  - 本记录文件。

## 验证方式与结果

- 验证方式：目视检查 Markdown 与 ASCII 图可读性、路径引用存在且可打开。
- 结果：已更新文档与记录。

