# 代码改动任务记录：补充 Unity ECS 对标说明（B3.4 视图关系与约束口径）

## 1) 任务概述

- 目标：把 `docs/tech/pgd-route-b-native-kernel-assessment.md` 中 “B3.4 规则听起来像 Unity ECS” 的表述完全展开，澄清 Unity ECS 的视图关系与本仓库 B3 的准确类比点。
- 影响范围：仅文档变更；不涉及代码/配置调整。

## 2) 聊天与讨论背景

- 用户关切：Unity ECS 是重要学习对象，但引擎 C++ 源码不可得，担心无法理解 “C# 侧存储结构如何在 C++ 侧处理（NativeArray）”。
- 用户进一步要求：把这部分解释写回文档，放到“对应位置”以便后续讨论统一口径。

## 3) 设计思路

- 不试图“猜 Unity 引擎私有 C++ 实现细节”，只写公开事实能支撑的口径：
  - `NativeArray<T>`/NativeContainer 是 C# 对 native 内存的视图（指针 + 长度 + 分配器/安全句柄等要素）
  - “像 Unity ECS”指的是同类工程约束：并行 job 期间保持指针/布局/生命周期稳定，结构变更必须在同步点发生
- 把 B3 的关键句改成“更准确的主语”：不是 UE C++ 拿托管 `T[]` 的视图，而是 PGD 改为 native-backed 后同时提供 C# `Span<T>` 与 C++ `T*` 两种视图。

## 4) 关键改动说明

- 在 `docs/tech/pgd-route-b-native-kernel-assessment.md` 的 B3.4 后追加对标小节：
  - 明确 Unity ECS vs B3 的“视图关系”与“共同约束”
  - 用一句话总结共同点：并行 job 期间指针稳定/布局稳定/生命周期可控，结构变更在同步点发生

## 5) 关键内容解析（文档逻辑链路）

```
B3.4 的规则（禁止扩容/结构变更）为什么必须存在
  -> 因为 worker kernel 手里拿的是 T* 指针
  -> 扩容/搬迁/释放会让指针失效
  -> 这类约束与 Unity ECS 的 barrier/ECB 思想同源（不是实现相同，而是约束同类）
```

## 6) 涉及文件清单

- 修改：`docs/tech/pgd-route-b-native-kernel-assessment.md`（在 B3.4 后新增 Unity ECS 对标段落，澄清视图关系与约束口径）
- 新增：`task_record/archive/2026-W03/code_change_task_20260116_094221.md`（本记录）
- 修改：`task_record/index.md`（追加索引行）

## 7) 验证方式与结果

- 验证方式：目视检查 Markdown 标题层级与段落逻辑，确认新增内容落在 B3.4 对应位置且不改变既有结论。
- 结果：通过（口径更明确，避免“Unity=反过来”的误读）。

