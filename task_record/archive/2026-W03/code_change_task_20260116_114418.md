# 代码改动任务记录：路线B3补充“并行粒度归属（PGD vs UE）”结论

## 1) 任务概述

- 目标：将“是否让 UE 自行决定 PGD/IQuery 并行粒度”的讨论结论补充进路线 B3（native-backed storage / native kernel）的评估文档，作为后续并行化设计的统一口径。
- 影响范围：仅文档变更。

## 2) 聊天与讨论背景

- 用户要求：把关于“UE 自行决定并行粒度是否适用于 PGD ECS”的结论写回 `docs/tech/pgd-route-b-native-kernel-assessment.md`。
- 关键前提：B3 场景下 worker 直接拿 `T*` 读写，barrier/禁止区与任务粒度是同一套问题，必须在同一份路线评估文档中明确。

## 3) 设计思路

- 将“粒度”拆成两层，避免概念混淆：
  - 语义粒度：chunk/section/阈值/依赖与 barrier（应由 PGD 控制）
  - 执行粒度：提交多少 task、每段多长（UE 可参与调度，但不应全权控制）
- 给出面向极高性能的分层策略：PGD 控制切分与阈值，UE 负责线程调度；必要时仅在单段内二级拆分，且仍需阈值约束。

## 4) 关键改动说明

- 在 `docs/tech/pgd-route-b-native-kernel-assessment.md` 新增 `B3.3.1` 小节：
  - 明确结论：不建议把 IQuery 并行粒度全权交给 UE
  - 解释原因：多段连续内存、flatten 拷贝风险、过度切分调度开销、barrier 显式性
  - 给出推荐策略与一句话原则（PGD 怎么切，UE 怎么跑）

## 5) 涉及文件清单

- 修改：`docs/tech/pgd-route-b-native-kernel-assessment.md`
- 新增：`task_record/archive/2026-W03/code_change_task_20260116_114418.md`（本记录）
- 修改：`task_record/index.md`

## 6) 验证方式与结果

- 验证方式：目视检查新增小节位置（B3.3 与 B3.4 之间）与段落逻辑；确认与 B3.4 禁止区/同步点口径一致。
- 结果：通过。

