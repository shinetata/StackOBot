# 代码变更任务记录：修复 TaskGraph PoC 的 mono_thread_attach 链接错误

## 任务概述
- 目标：解决 VS 重新生成时报 `LNK2019 unresolved external symbol mono_thread_attach`，使 UnrealCSharp 模块中的 TaskGraph PoC 可成功链接编译。
- 范围：在 UnrealCSharpCore 增加线程 attach 的统一封装，并在 PoC 中改用该封装；不改变 PoC 的行为语义。

## 问题现象
- VS 编译失败（链接阶段）：
  - `LNK2019 unresolved external symbol mono_thread_attach ... referenced in ... FTaskGraph::EnqueueProbeImplementation`

## 根因分析
- `mono_thread_attach` 属于 Mono runtime 符号，链接库依赖由 UnrealCSharpCore 模块承担。
- PoC 文件位于 UnrealCSharp 模块（`Plugins/UnrealCSharp/Source/UnrealCSharp/...`），直接调用 `mono_thread_attach` 会导致 UnrealCSharp 模块链接阶段缺少该符号。

## 关键改动
- `Plugins/UnrealCSharp/Source/UnrealCSharpCore/Public/Domain/FMonoDomain.h`
  - 新增 `static void EnsureThreadAttached();`
- `Plugins/UnrealCSharp/Source/UnrealCSharpCore/Private/Domain/FMonoDomain.cpp`
  - 实现 `EnsureThreadAttached()`：内部调用 `mono_thread_attach(Domain)`（并在 `Domain==nullptr` 时直接返回）
- `Plugins/UnrealCSharp/Source/UnrealCSharp/Private/Domain/InternalCall/FTaskGraph.cpp`
  - 将直接调用 `mono_thread_attach` 改为 `FMonoDomain::EnsureThreadAttached()`，并移除对 `mono/metadata/threads.h` 的直接 include

## 涉及文件清单
- 修改：`Plugins/UnrealCSharp/Source/UnrealCSharpCore/Public/Domain/FMonoDomain.h`
- 修改：`Plugins/UnrealCSharp/Source/UnrealCSharpCore/Private/Domain/FMonoDomain.cpp`
- 修改：`Plugins/UnrealCSharp/Source/UnrealCSharp/Private/Domain/InternalCall/FTaskGraph.cpp`
- 新增：`task_record/code_change_task_20260113_105409.md`
- 修改：`task_record/index.md`

## 验证方式（建议）
- 重新生成 `StackOBotEditor`：确认不再出现 `mono_thread_attach` 的 `LNK2019`。
- 运行 PIE：调用 `TaskGraphProbe.Enqueue(123)`，验证 `[TaskGraphProbe] ... GT=... Worker=...`。

## 回滚方式
- 删除 `EnsureThreadAttached` 并把 PoC 恢复为直接调用（不推荐），或整体回退到引入该改动前的版本。

